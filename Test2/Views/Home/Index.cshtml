<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<div class="text-center">
    <h1 class="display-4">SmartStall</h1>
</div>
<br />
<br />
<div class="custom-control custom-switch text-right">
    <input type="checkbox" class="custom-control-input" id="customSwitch1">
    <label class="custom-control-label" for="customSwitch1">Benachrichtigung</label>
</div>
<div class="custom-control custom-switch container text-right">
    <input type="checkbox" class="custom-control-input" id="customSwitch2">
    <label class="custom-control-label" for="customSwitch2">Belüftung &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
</div>
<!----------------------------------------Ammoniak----------------------------------------------->
<div>
    <h2>Ammoniak</h2>
    <div class="btn-group" role="group" aria-label="Chart View">
        <button id="wocheBtnAmmoniak" type="button" class="btn btn-secondary">Woche</button>
        <button id="tagBtnAmmoniak" type="button" class="btn btn-secondary active">Tag</button>
    </div>
    <canvas id="lineChartAmmoniak"></canvas>
</div>
<!---------------------------------------------------------------------------------------------->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>*@

<script>
        var lineChartAmmoniak;
        var dataAmmoniak;
        var labelWoche = ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"];
        var labelTag = ["00-01 Uhr", "02-03 Uhr", "04-05 Uhr", "06-07 Uhr", "08-09 Uhr", "10-11 Uhr", "12-13 Uhr", "14-15 Uhr", "16-17 Uhr", "18-19 Uhr", "20-21 Uhr", "22-23 Uhr"];

        buildDiagramms();
        setInterval(aktualisiereView, 60000);

        document.getElementById("tagBtnAmmoniak").addEventListener("click", function () {
            var dataLabels = labelTag;
            dataAmmoniak.labels = dataLabels;

            $.ajax({
                url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (ammoniakData) {

                    lineChartAmmoniak.data.datasets[0].data = JSON.parse(ammoniakData["ammoniakWerteTagDurchschnitt"]); //Durchschnitt
                    lineChartAmmoniak.data.datasets[1].data = JSON.parse(ammoniakData["ammoniakWerteTagAktuell"]); //Aktuell

                    // Diagramm neu zeichnen
                    lineChartAmmoniak.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
                }
            });

            lineChartAmmoniak.update();
        });

        document.getElementById("wocheBtnAmmoniak").addEventListener("click", function () {
            var dataLabels = labelWoche;
            dataAmmoniak.labels = dataLabels;

            $.ajax({
                url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (ammoniakData) {

                    lineChartAmmoniak.data.datasets[0].data = JSON.parse(ammoniakData["ammoniakWerteWocheDurchschnitt"]); //Durchschnitt
                    lineChartAmmoniak.data.datasets[1].data = JSON.parse(ammoniakData["ammoiakWerteWocheAktuell"]); //Aktuell

                    // Diagramm neu zeichnen
                    lineChartAmmoniak.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
                }
            });

            lineChartAmmoniak.update();
        });

        function buildDiagramms() {

            ammoniakDiagramm();
        }

        function ammoniakDiagramm() {

            var ammoniakWerteTagDurchschnitt = @Html.Raw(ViewBag.ammoniakWerteTagDurchschnitt);
            var ammoniakWerteTagAktuell = @Html.Raw(ViewBag.ammoniakWerteTagAktuell);

            var grenzeTag = ["10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10"];

            dataAmmoniak = {
                labels: labelTag,
                datasets: [
                    {
                        label: "Ammoniak-Durchschnitt",
                        data: ammoniakWerteTagDurchschnitt,
                        fill: true,
                        borderColor: "rgb(219, 211, 123)",
                        tension: 0.2
                    },
                    {
                        label: "Ammoniak aktuell",
                        data: ammoniakWerteTagAktuell,
                        fill: false,
                        borderColor: "rgb(13, 13, 13)",
                        tension: 0.2
                    },
                    {
                        label: "Ammoniakgrenze",
                        data: grenzeTag,
                        fill: true,
                        borderColor: "rgb(240, 2, 2)",
                        tension: 0.1
                    }
                ]
            };

            var options1 = {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Amminiakgehalt in ppm'
                        }
                    }
                }
            };

            lineChartAmmoniak = new Chart($("#lineChartAmmoniak"), {
                type: "line",
                data: dataAmmoniak,
                options: options1
            });
        }

        function aktualisiereView() {
            $.ajax({
                url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (ammoniakData) {

                    lineChartAmmoniak.data.datasets[0].data = ammoniakData;

                    // Diagramm neu zeichnen
                    lineChartAmmoniak.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
                }
            });
        }
</script>